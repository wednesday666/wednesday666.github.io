<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Posts on 随笔记</title>
    <link>https://weekthree.github.io/post/</link>
    <description>Recent content in Posts on 随笔记</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-cn</language>
    <lastBuildDate>Fri, 10 Jun 2022 00:00:00 +0000</lastBuildDate><atom:link href="https://weekthree.github.io/post/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Array 函数效率问题</title>
      <link>https://weekthree.github.io/p/array-%E5%87%BD%E6%95%B0%E6%95%88%E7%8E%87%E9%97%AE%E9%A2%98/</link>
      <pubDate>Fri, 10 Jun 2022 00:00:00 +0000</pubDate>
      
      <guid>https://weekthree.github.io/p/array-%E5%87%BD%E6%95%B0%E6%95%88%E7%8E%87%E9%97%AE%E9%A2%98/</guid>
      <description>起因 PHP Array 函数是 PHP 核心的组成部分，我们在编写 PHP 代码的时候，这些内置的 Array 函数给我们提供了极大的便利。但是有一次我发现在测试环境执行无异常的代码，在线上执行却超时了。 开始以为是代码里面有 SQL 慢查询导致的，但是排查相关的数据库语句并没有发现什么问题。最后定位到一段遍历语句当中，里面用到了三个数组函数，分别是数组合并函数array_merge()，数组查找函数array_search()和in_array()。 我们先看下面这段垃圾代码。
foreach ($poolStr as $poolIds) { $poolId = explode(&amp;#39;,&amp;#39;, $poolIds); $batchPool = array_merge($batchPool, $poolId); } ... foreach ($batchPool as $bp) { $postId = array_search($bp,$turnPool); if ($postId &amp;amp;&amp;amp; in_array($postId,$onlinePost)) { //do somgthing } } 通过分析，意识到虽然这里并没有相关的数据库查询操作，但是遍历可能涉及到大量的循环，相关内置函数的效率问题会明显放大。 下面用例子证明一下。（使用相同的range()函数创建一样长度的数组，这次不考虑range()函数的时间消耗。)
Array 函数 array_merge() 我们循环10000次，每次生成10个元素的数组，然后使用array_merge()函数合并成一个大数组。经过测试发现，10000次循环合并就要花费4秒多。
&amp;lt;?php /** * 获取毫秒 */ if (!function_exists(&amp;#39;getMsectime&amp;#39;)) { function getMsectime() { list($msec, $sec) = explode(&amp;#39; &amp;#39;, microtime()); return (float)sprintf(&amp;#39;%.</description>
    </item>
    
    <item>
      <title>Redis 6.0新特性</title>
      <link>https://weekthree.github.io/p/redis-6.0%E6%96%B0%E7%89%B9%E6%80%A7/</link>
      <pubDate>Tue, 09 Nov 2021 00:00:00 +0000</pubDate>
      
      <guid>https://weekthree.github.io/p/redis-6.0%E6%96%B0%E7%89%B9%E6%80%A7/</guid>
      <description>IO 多线程 Redis 一直被大家熟知的就是它的单线程架构，虽然有些命令操作可以用后台线程或子进程执行（比如数据删除、快照生成、AOF 重写），但是，从网络 IO 处理到实际的读写命令处理，都是由单个线程完成的。
在 6.0 版本之前，Redis采用了采用了多路 I/O 复用技术，这里的多路指的是多个 socket 网络连接，复用指的是复用同一个线程。通过多路 I/O 复用技术在同一个线程中处理多个 I/O 请求，尽量减少网络 I/O 的消耗，提升使用效率。 基于多路复用的Redis高性能IO模型但随着网络硬件的性能提升，Redis的性能瓶颈有时会出现在网络 IO 的处理上，单个主线程处理网络请求的速度跟不上底层网络硬件的速度。
在 6.0 版本中，Redis把请求网络包读写和解析也从主线程中剥离出来了。
Redis 6.0 采用多个 IO 线程来处理网络请求，提高网络请求处理的并行度。但是对于读写命令，仍然使用单线程来处理。
这样实现有两个好处：
通过多个IO线程并行处理网络操作，解决网络处理瓶颈提升实例的整体处理性能。 读写命令继续使用单线程处理，可以避免上下文切换和不必要的线程之间引起的资源竞争，线程模型更简单。 处理流程 主线程和多 IO 线程的协作主要分成以下几个阶段：
服务端和客户端建立 Socket 连接，并分配处理线程。 IO 线程读取并解析请求。 主线程执行请求操作。 IO线程回写 Socket 和主线程清空全局队列 在第2、4阶段，由于加入了 IO 多线程，多个 IO 线程并行处理读取与解析请求，以及回写 Socket 的操作都会很快。因此可以加速网络处理，进而提升实例的吞吐量。 IO多线程处理流程开启多线程 默认情况下，多线程是关闭的。如果需要启动，要在 redis.conf 进行以下配置。
#启用多线程 io-threads-do-reads yes #设置线程个数 io-threads 6 需要注意的是，线程个数要小于实例所在的 CPU 核个数。对于 8 核 CPU 的机器，官方建议配置 6 个 IO 线程。 权限控制 在 Redis 6.</description>
    </item>
    
    <item>
      <title>Php 垃圾回收机制</title>
      <link>https://weekthree.github.io/p/php-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6/</link>
      <pubDate>Sun, 29 Aug 2021 10:55:45 +0800</pubDate>
      
      <guid>https://weekthree.github.io/p/php-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6/</guid>
      <description>概念 PHP本身实现了垃圾回收机制(Garbage Collection)，让程序员不必过分关心程序内存分配，从而将更多的精力投入到业务逻辑。
PHP中的变量划分为三大类：
标量数据类型 包括布尔型、整型、浮点型和字符串 复合数据类型。 包括数组、对象; 特殊数据类型 包括资源、null PHP变量的管理基于引用计数+写时复制实现的。
引用计数 PHP把所有类型变量都存在一个叫 &amp;ldquo;zval&amp;quot;的变量容器中，变量的内存是通过引用计数进行管理的。 zval变量容器，除了包含变量的类型和值，还包括两个字节的额外信息
is_ref a. bool类型，用来表示变量是否属于引用集合。 refcount a. 表示指向这个zval变量容器的变量个数。 PHP 5.x 在PHP5中，zval 的内存是单独从堆中分配的，PHP 需要知道哪些 zval 是正在使用的，哪些是需要释放的。所以这就需要用到引用计数来保存zval本身被引用的次数。如果引用计数变成 0，就意味着这个变量已经没有用了，内存也就可以释放了。
标量类型 当一个变量被赋常量值时，就会生成一个zval变量容器。
$a = &amp;#34;hello&amp;#34;; xdebug_debug_zval(&amp;#39;a&amp;#39;); a: (refcount=1, is_ref=0),string &amp;#39;hello&amp;#39; (length=5) 这里只有一个变量使用这个变量容器，所以refcount=1。 没有任何自定义的引用， 所以is_ref也是0。
把一个变量赋值给另一变量将增加引用次数。
$a = &amp;#34;hello&amp;#34;; $b = $a; xdebug_debug_zval(&amp;#39;a&amp;#39;); xdebug_debug_zval(&amp;#39;b&amp;#39;); $b = &amp;#34;hi&amp;#34;; xdebug_debug_zval(&amp;#39;a&amp;#39;); xdebug_debug_zval(&amp;#39;b&amp;#39;); a: (refcount=2, is_ref=0),string &amp;#39;hello&amp;#39; (length=5) b: (refcount=2, is_ref=0),string &amp;#39;hello&amp;#39; (length=5) a: (refcount=1, is_ref=0),string &amp;#39;hello&amp;#39; (length=5) b: (refcount=1, is_ref=0),string &amp;#39;hi&amp;#39; (length=2) 当执行 $b=$a时，引用次数是2，因为同一个变量容器被变量a和变量b关联，这时候PHP还没有必要去复制已生成的变量容器。当$b重新赋值时，才会进行内存复制，此时refcount分别都变成1。</description>
    </item>
    
    <item>
      <title>基于Redis GEO实现的LBS功能</title>
      <link>https://weekthree.github.io/p/%E5%9F%BA%E4%BA%8Eredis-geo%E5%AE%9E%E7%8E%B0%E7%9A%84lbs%E5%8A%9F%E8%83%BD/</link>
      <pubDate>Tue, 09 Mar 2021 00:00:00 +0000</pubDate>
      
      <guid>https://weekthree.github.io/p/%E5%9F%BA%E4%BA%8Eredis-geo%E5%AE%9E%E7%8E%B0%E7%9A%84lbs%E5%8A%9F%E8%83%BD/</guid>
      <description>介绍 Redis除了5大基本数据类型：String、List、Hash、Set和Sorted Set。还提供了3种拓展数据类型，分别是Bitmap、HyperLogLog和GEO。
GEO是Redis 3.2 版本中新增的专门面向LBS应用的一种数据类型。使用它我们可以非常方便的实现一些**基于位置信息服务(Location-Based Service,LBS)**的应用。例如打车软件获得离用户最近的车辆信息。或者根据用户点阅的物件展示周边距离最近的物件。利用GEO和经纬度信息可以很简单的获取到数据。
如何使用 数据存储Redis 使用前，需要将经纬度数据准备好，使用以下命令存储到Redis中。
GEOADD key longitude latitude member [longitude latitude member ...] 例如，物件ID是1001的经纬度信息为114.143701,22.408597
GEOADD data:locations 114.143701 22.408597 1001 将所有数据插入到Redis后，我们就可以开始获取想要的数据了。
获取范围内的数据 根据经纬度 例如，我们想根据经纬度获得离它5km范围最近的三笔数据，按距离由近到远排序。
&amp;gt; GEORADIUS data:locations 114.152801 22.411597 5 km ASC COUNT 3 1003 1001 1002 返回的数据就是按直线距离排序好的成员ID。其中参数5 km就是限制距离范围。支持多种单位长度
m表中单位为米 km表示千米 mi表示英里 ft表示为英尺 根据已有成员 也可以直接根据已有成员的经纬度获得数据
&amp;gt; GEORADIUSBYMEMBER data:locations 1001 5 km ASC COUNT 3 WITHDIST WITHCOORD 1001 0.0000 114.14370328187942505 22.40859655827627961 1002 1.1170 114.14270013570785522 22.41859603324986239 1003 1.</description>
    </item>
    
    <item>
      <title>Chinese Test</title>
      <link>https://weekthree.github.io/p/test-chinese/</link>
      <pubDate>Wed, 09 Sep 2020 00:00:00 +0000</pubDate>
      
      <guid>https://weekthree.github.io/p/test-chinese/</guid>
      <description>正文测试 而这些并不是完全重要，更加重要的问题是， 带着这些问题，我们来审视一下学生会退会。 既然如何， 对我个人而言，学生会退会不仅仅是一个重大的事件，还可能会改变我的人生。 我们不得不面对一个非常尴尬的事实，那就是， 可是，即使是这样，学生会退会的出现仍然代表了一定的意义。 学生会退会，发生了会如何，不发生又会如何。 经过上述讨论， 生活中，若学生会退会出现了，我们就不得不考虑它出现了的事实。 学生会退会，到底应该如何实现。 这样看来， 在这种困难的抉择下，本人思来想去，寝食难安。 对我个人而言，学生会退会不仅仅是一个重大的事件，还可能会改变我的人生。 就我个人来说，学生会退会对我的意义，不能不说非常重大。 莎士比亚曾经提到过，人的一生是短的，但如果卑劣地过这一生，就太长了。这似乎解答了我的疑惑。 莫扎特说过一句富有哲理的话，谁和我一样用功，谁就会和我一样成功。这启发了我， 对我个人而言，学生会退会不仅仅是一个重大的事件，还可能会改变我的人生。 学生会退会，到底应该如何实现。 一般来说， 从这个角度来看， 这种事实对本人来说意义重大，相信对这个世界也是有一定意义的。 在这种困难的抉择下，本人思来想去，寝食难安。 了解清楚学生会退会到底是一种怎么样的存在，是解决一切问题的关键。 一般来说， 生活中，若学生会退会出现了，我们就不得不考虑它出现了的事实。 问题的关键究竟为何？ 而这些并不是完全重要，更加重要的问题是。
奥斯特洛夫斯基曾经说过，共同的事业，共同的斗争，可以使人们产生忍受一切的力量。　带着这句话，我们还要更加慎重的审视这个问题： 一般来讲，我们都必须务必慎重的考虑考虑。 既然如此， 这种事实对本人来说意义重大，相信对这个世界也是有一定意义的。 带着这些问题，我们来审视一下学生会退会。 我认为， 我认为， 在这种困难的抉择下，本人思来想去，寝食难安。 问题的关键究竟为何？ 每个人都不得不面对这些问题。 在面对这种问题时， 要想清楚，学生会退会，到底是一种怎么样的存在。 我认为， 既然如此， 每个人都不得不面对这些问题。 在面对这种问题时， 那么， 我认为， 学生会退会因何而发生。
引用 思念是最暖的忧伤像一双翅膀
让我停不了飞不远在过往游荡
不告而别的你 就算为了我着想
这么沉痛的呵护 我怎么能翱翔
最暖的憂傷 - 田馥甄
图片 Photo by Florian Klauer on UnsplashPhoto by Luca Bravo on UnsplashPhoto by Helena Hertz on UnsplashPhoto by Hudai Gayiran on Unsplash!</description>
    </item>
    
    <item>
      <title>Markdown Syntax Guide</title>
      <link>https://weekthree.github.io/p/markdown-syntax-guide/</link>
      <pubDate>Mon, 11 Mar 2019 00:00:00 +0000</pubDate>
      
      <guid>https://weekthree.github.io/p/markdown-syntax-guide/</guid>
      <description>&lt;p&gt;This article offers a sample of basic Markdown syntax that can be used in Hugo content files, also it shows whether basic HTML elements are decorated with CSS in a Hugo theme.&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>Rich Content</title>
      <link>https://weekthree.github.io/p/rich-content/</link>
      <pubDate>Sun, 10 Mar 2019 00:00:00 +0000</pubDate>
      
      <guid>https://weekthree.github.io/p/rich-content/</guid>
      <description>&lt;p&gt;Hugo ships with several &lt;a class=&#34;link&#34; href=&#34;https://gohugo.io/content-management/shortcodes/#use-hugo-s-built-in-shortcodes&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Built-in Shortcodes&lt;/a&gt; for rich content, along with a &lt;a class=&#34;link&#34; href=&#34;https://gohugo.io/about/hugo-and-gdpr/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Privacy Config&lt;/a&gt; and a set of Simple Shortcodes that enable static and no-JS versions of various social media embeds.&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>مثال نص</title>
      <link>https://weekthree.github.io/p/%D9%85%D8%AB%D8%A7%D9%84-%D9%86%D8%B5/</link>
      <pubDate>Sat, 09 Mar 2019 00:00:00 +0000</pubDate>
      
      <guid>https://weekthree.github.io/p/%D9%85%D8%AB%D8%A7%D9%84-%D9%86%D8%B5/</guid>
      <description>فقرة 1 هذا النص هو مثال لنص يمكن أن يستبدل في نفس المساحة، لقد تم توليد هذا النص من مولد النص العربى، حيث يمكنك أن تولد مثل هذا النص أو العديد من النصوص الأخرى إضافة إلى زيادة عدد الحروف التى يولدها التطبيق. إذا كنت تحتاج إلى عدد أكبر من الفقرات يتيح لك مولد النص العربى زيادة عدد الفقرات كما تريد، النص لن يبدو مقسما ولا يحوي أخطاء لغوية، مولد النص العربى مفيد لمصممي المواقع على وجه الخصوص، حيث يحتاج العميل فى كثير من الأحيان أن يطلع على صورة حقيقية لتصميم الموقع.</description>
    </item>
    
    <item>
      <title>Math Typesetting</title>
      <link>https://weekthree.github.io/p/math-typesetting/</link>
      <pubDate>Fri, 08 Mar 2019 00:00:00 +0000</pubDate>
      
      <guid>https://weekthree.github.io/p/math-typesetting/</guid>
      <description>&lt;p&gt;Mathematical notation in a Hugo project can be enabled by using third party JavaScript libraries.&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>Emoji Support</title>
      <link>https://weekthree.github.io/p/emoji-support/</link>
      <pubDate>Tue, 05 Mar 2019 00:00:00 +0000</pubDate>
      
      <guid>https://weekthree.github.io/p/emoji-support/</guid>
      <description>&lt;p&gt;Emoji can be enabled in a Hugo project in a number of ways.&lt;/p&gt;</description>
    </item>
    
  </channel>
</rss>
